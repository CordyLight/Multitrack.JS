<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Плеер для сайта ТО "Магия дружбы"</title>
    <script src="player.js"></script>
    <link rel="stylesheet/less" type="text/css" href="player.less" />
    <script src="//cdnjs.cloudflare.com/ajax/libs/less.js/3.9.0/less.min.js"></script>
    <style>
        *[multitrack-js] {
            width: 854px;
            height: 480px;
        }
    </style>
</head>

<body>
    <button onclick="window.location.reload(true)">force reload</button>
    <button onclick="player.resize()">resize subs</button>
    <div id="player"></div>
    <script src="//cdn.jsdelivr.net/npm/assjs/dist/ass.js"></script>
    <script>
        var player;
        less.refresh().then(() => {
            let episodename = "School Daze, part 1"
            var xhr = new XMLHttpRequest();
            xhr.open('GET', `//bronyru.info/api/episodes/search?query=${encodeURI(episodename)}&size=0`, false);
            xhr.send();
            if (xhr.status == 200) {
                let episodeData = JSON.parse(xhr.responseText).data[0];
                console.log(episodeData)

                player = new MultitrackJS("#player", {
                    video: `${episodeData.path}1080.mp4`,
                    audio: `${episodeData.path}has.mp4`,
                    subtitles: `${episodeData.path}a2a-rus.ass`,
                    title: episodeData.title.eng,
                    preview: `${episodeData.path}preview.webp`
                });
                //this.setSubtitles(xhr.responseText);
            } else {
                alert(xhr.status + ': ' + xhr.statusText);
            }
        });
    </script>
</body>

</html>